<header class="header">
    <div class="header-middle sticky-header">
        <div class="container">
            <div class="header-left">
                <button class="mobile-menu-toggler">
                    <span class="sr-only">Toggle mobile menu</span>
                    <i class="icon-bars"></i>
                </button>

                <a href="/" class="logo">
                    <img src="/images/Lexxive.png" alt="Lexxive Logo" width="130" height="30">
                </a>

                <nav class="main-nav">
                    <ul class="menu sf-arrows">
                        <li class="<%= currentPage === 'home' ? 'active' : '' %>">
                            <a href="/">Home</a>
                        </li>
                        <li class="<%= currentPage === 'products' ? 'active' : '' %>">
                            <a href="/productList">Shop</a>
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="header-right">
                <div class="header-search">
                    <a href="#" class="search-toggle" role="button" title="Search">
                        <i class="icon-search"></i>
                    </a>
                    <form action="#" method="get">
                        <div class="header-search-wrapper">
                            <label for="q" class="sr-only">Search</label>
                            <input type="search" class="form-control" name="q" id="q" placeholder="Search in..." required>
                        </div>
                    </form>
                </div>
                
                <a href="/wishlist" class="wishlist-link <%= currentPage === 'wishlist' ? 'active' : '' %>">
                    <i class="icon-heart-o"></i>
                </a>

                <div class="dropdown cart-dropdown">
                    <a href="/cart" class="dropdown-toggle <%= currentPage === 'cart' ? 'active' : '' %>" role="button">
                        <i class="icon-shopping-cart"></i>
                        <% if(numberOfProduct && numberOfProduct > 0) { %>
                            <span class="cart-count"><%= numberOfProduct %></span>
                        <% } %>
                    </a>
                </div>
                
                <a href="/userProfile" class="wishlist-link <%= currentPage === 'profile' ? 'active' : '' %>">
                    <i class="fa-regular fa-user fa-xs"></i>
                </a>
            </div>
        </div>
    </div>
</header>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function(){
        let timeout;

        $('#q').on('input', function(){
            clearTimeout(timeout);

            timeout = setTimeout(function() {
                var searchQuery = $('#q').val();
                if(searchQuery.trim() !== '') {
                    $.ajax({
                        url:'/productSearch',
                        method:'POST',
                        data:{q:searchQuery},
                        success: function(response){
                            window.location.href = '/searchedProduct?searchResults=' + encodeURIComponent(JSON.stringify(response.searchResults));
                        },
                        error: function(error) {
                            console.log(error);
                        }
                    });
                }
            }, 800);
        });
    });
</script>

<style>
    .active {
        color: tomato !important;
    }
    .cart-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background-color: tomato;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 12px;
    }
    .dropdown.cart-dropdown {
        position: relative;
    }
</style>