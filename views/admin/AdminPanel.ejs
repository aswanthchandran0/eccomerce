<%- include('./layout/header.ejs') %>
   <% currentPage = 'Dashboard' %>
    <div class="container-scroller ">
      <!-- partial:partials/_sidebar.html -->
    <%- include('./layout/sideBar.ejs')  %>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper bg-gray-dark">
        <!-- partial:partials/_navbar.html -->
       
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper ">
           
            <div class="row">
              <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                <div class="card   ">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-9 ">
                        <div class="d-flex align-items-center align-self-start ">
                          <h3 class="mb-0">
                            <% if(yearlyIncome !== null && yearlyIncome !== undefined){%>
                              ₹<%= yearlyIncome %>
                              <%}else{%>
                                ₹0
                                <%}%>
                           </h3>
                         
                        </div>
                      </div>
                      
                    </div>
                    <h6 class="text-muted mt-1 font-weight-normal">Yearly revenue</h6>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-9">
                        <div class="d-flex align-items-center align-self-start">
                          <h3 class="mb-0">
                            <% if(monthlyIncome !== null && monthlyIncome !== undefined){%>
                              ₹<%= monthlyIncome %>
                              <%}else{%>
                                ₹0
                                <%}%>
                           </h3>
                        
                        </div>
                      </div>
                     
                    </div>
                    <h6 class="text-muted mt-1 font-weight-normal">Monthly income</h6>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-9">
                        <div class="d-flex align-items-center align-self-start">
                          <h3 class="mb-0">
                            <% if(todayIncome  !== null && todayIncome  !== undefined){%>
                              ₹<%= todayIncome %>
                              <%}else{%>
                                ₹0
                                <%}%>

                            </h3>
                          
                        </div>
                      </div>
                     
                    </div>
                    <h6 class="text-muted mt-1 font-weight-normal">Daily Income</h6>
                  </div>
                </div>
              </div>
              <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-9">
                        <div class="d-flex align-items-center align-self-start">
                          <h3 class="mb-0">
                            <% if(productExpense !== null && productExpense!== undefined){%>
                              ₹<%= productExpense %>
                              
                              <%}else{%>
                                ₹0
                                <%}%>
                              </h3>
                          
                       
                        </div>
                      </div>
                      
                    </div>
                    <h6 class="text-muted mt-1 font-weight-normal">Expense current</h6>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-4 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">Transaction History</h4>
                    <!---->

                    <div class="holder">
                      <canvas id='day' width='150px'></canvas>
                      </div>
                      
                    <!---->

                   <!-- <canvas id="transaction-history" class="transaction-chart"></canvas>  -->
                    <div class="bg-gray-dark d-flex d-md-block d-xl-flex flex-row py-3 px-4 px-md-3 px-xl-4 rounded mt-3">
                      <div class="text-md-center text-xl-left">
                        <h6 class="mb-1">Transfer to RazorPay</h6>
                        <p class="text-muted mb-0">  
                          <% if(latesOnlinePaymentDate !== null && latesOnlinePaymentDate !== undefined){%>
                          
                            <%= latesOnlinePaymentDate.toLocaleString() %>
                            <%}else{%>
                            Date
                              <%}%>

                         </p>
                      </div>
                      <div class="align-self-center flex-grow text-right text-md-center text-xl-right py-md-2 py-xl-0">
                        <h6 class="font-weight-bold mb-0">
                          <% if(onlinePayment !== null && onlinePayment !== undefined){%>
                          
                            ₹ <%= onlinePayment %>
                            <%}else{%>
                           ₹0
                              <%}%>

                          </h6>
                      </div>
                    </div>
                    <div class="bg-gray-dark d-flex d-md-block d-xl-flex flex-row py-3 px-4 px-md-3 px-xl-4 rounded mt-3">
                      <div class="text-md-center text-xl-left">
                        <h6 class="mb-1">Cash on delevery</h6>
                        <p class="text-muted mb-0">   <% if(latestcashOnDeliveryDate !== null && latestcashOnDeliveryDate !== undefined){%>
                          
                          <%= latestcashOnDeliveryDate.toLocaleString() %>
                          <%}else{%>
                         Date
                            <%}%>
                            
                            </p>
                      </div>
                      <div class="align-self-center flex-grow text-right text-md-center text-xl-right py-md-2 py-xl-0">
                        <h6 class="font-weight-bold mb-0">₹ <%= cashOnDelivery %></h6>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-8 grid-margin stretch-card">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex flex-row justify-content-between">
                      <h4 class="card-title mb-1">Most Sold Products</h4>
                      <p class="text-muted mb-1">Product status</p>
                    </div>
                    <div class="row">
                        <% if(mostSoldProducts !==null && mostSoldProducts.length>0){%>
                          <% mostSoldProducts.forEach((product)=>{%>
                            <%if(product.product){%>
                      <div class="col-12">
                        <div class="preview-list">
                          
                         
                          <div class="preview-item border-bottom">
                            <div class="preview-thumbnail">
                              <div class="preview-icon bg-info">
                                <img src="/<%= product.product.images[0] %>" alt="Product Image">
                              </div>
                            </div>
                            <div class="preview-item-content d-sm-flex flex-grow">
                              <div class="flex-grow">
                                <h6 class="preview-subject"><%= product.product.ProductName %></h6>
                                <p class="text-muted mb-0"><%= product.product.ProductDiscription %></p>
                              </div>
                              <div class="mr-auto text-sm-right pt-2 pt-sm-0">
                                <p class="text-muted">Sold: <%= product.count %></p>
                                <p class="text-muted mb-0">₹:<%= product.product.ProductPrice %></p>
                              </div>
                            </div>
                          </div>
                          
                    
                        </div>
                      </div>
                      <%}%>
                      <%})%>
                      <%}%>
                    </div>
                  </div>
                </div>
              </div>
            </div>
           
           


          </div>
          <!-- content-wrapper ends -->
          <!-- partial:partials/_footer.html -->
         
          <!-- partial -->
        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
<!-- cashOnDeliveryTotal,walletTotal,onlinePaymentTotal -->
      <input id="cashOnDelivery" type="hidden" value="<%= cashOnDelivery %> ">
      <input id="wallet" type="hidden" value="<%=walletTotal %>">
      <input id="RazorPay" type="hidden" value="<%=onlinePaymentTotal %>">
    </div>
    
    <script src="//cdn.jsdelivr.net/npm/chart.js"></script>


    <script>
      const cashOnDelivery = document.getElementById('cashOnDelivery').value
      const wallet = document.getElementById('wallet').value
      const RazorPay = document.getElementById('RazorPay').value
    
      var options = {
        animation: {
          animateRotate: true,
          animateScale: true,
        },
        percentageInnerCutout: 60,
        segmentShowStroke: false,
      };
    
      var data = [
        {
          value: RazorPay,
          color: "rgba(31,94,237,1)",
          backgroundColor: createLinearGradient("rgba(40,255,1,1)", "rgba(1,255,34,1)"),
          borderWidth: 0, // Set border width to 0 to remove the border
        },
        {
          value: cashOnDelivery,
          color: "rgb(241,255,1)",
          backgroundColor: createLinearGradient("rgba(241,255,1,1)", "rgba(241,255,1,1)"),
          borderWidth: 0, // Set border width to 0 to remove the border
        },
        {
          value:wallet,
          color: "rgb(0,31,141)",
          backgroundColor: createLinearGradient("rgba(0,31,141,1", "rgba(0,31,141,1)"),
          borderWidth: 0, // Set border width to 0 to remove the border
        },
      ];
    
      function createLinearGradient(color1, color2) {
        var canvas = document.createElement("canvas");
        var ctx = canvas.getContext("2d");
        var gradient = ctx.createLinearGradient(0, 0, 0, 200);
        gradient.addColorStop(0, color1);
        gradient.addColorStop(1, color2);
        return gradient;
      }
    
      var ctx = document.getElementById("day").getContext("2d");
      var dayObject = new Chart(ctx, {
        type: "doughnut",
        data: {
          datasets: [
            {
              data: data.map((item) => item.value),
              backgroundColor: data.map((item) => item.backgroundColor),
              borderWidth: data.map((item) => item.borderWidth), // Include borderWidth for each dataset
            },
          ],
          labels: ["Razorpay", "Cash on Delivery", "Wallet"],
        },
        options: options,
      });
    </script>
    
    
    
    <%- include('./layout/footer.ejs') %>
