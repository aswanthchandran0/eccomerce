<!-- Edit Category Modal -->
<div id="editCategoryModal-<%= category._id %>" 
     class="edit-category-modal" 
     style="display:none; height:300px; width:700px; position: fixed; 
            top:50%; left:55%; transform: translate(-50%, -50%); 
            background:#0e1111; padding:20px; border-radius:10px; 
            z-index:1000;">
    <h4>Edit Category</h4>
    <form>
        <div class="mb-3">
            <label for="categoryName-<%= category._id %>" class="form-label">Category Name</label>
            <input type="text" class="form-control" id="categoryName-<%= category._id %>" name="name" value="<%= category.name %>" required>
            <div id="categoryNameError-<%= category._id %>" class="text-danger mt-1"></div>
        </div>
        <div class="mb-3">
            <label for="categoryDesc-<%= category._id %>" class="form-label">Description</label>
            <textarea class="form-control" id="categoryDesc-<%= category._id %>" name="description" rows="3"><%= category.description %></textarea>
            <div id="categoryDescriptionError-<%= category._id %>" class="text-danger mt-1"></div>
        </div>
        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-success">Save</button>
            <button type="button" class="btn btn-danger" onclick="toggleEditCategoryModal('<%= category._id %>')">Cancel</button>
        </div>
    </form>
</div>

<script src="/javascripts/ajax.js"></script>
<script>
  document.querySelector("#editCategoryModal-<%= category._id %> form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = document.getElementById("categoryName-<%= category._id %>").value.trim();
    const description = document.getElementById("categoryDesc-<%= category._id %>").value.trim();

    const result = await ajaxRequest("/admin/categories/<%= category._id %>", "PUT", { name, description });

    if (result.success) {
      window.location.href = "/admin/categories";
    } else {
      if (result.errors && typeof result.errors === "object") {
        if (result.errors.name) {
          document.getElementById("categoryNameError-<%= category._id %>").innerText = result.errors.name;
        }
        if (result.errors.description) {
          document.getElementById("categoryDescriptionError-<%= category._id %>").innerText = result.errors.description;
        }
      } else {
        Toastify({
          text: result.message || "Something went wrong",
          duration: 4000,
          gravity: "top",
          position: "right",
          backgroundColor: "red",
          stopOnFocus: true
        }).showToast();
      }
    }
  });
</script>
