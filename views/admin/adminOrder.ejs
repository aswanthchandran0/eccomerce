<%- include('./layout/header.ejs') %>
<% currentPage = 'Orders' %>
<div class="container-scroller">
    <!-- partial:partials/_sidebar.html -->
    <%- include('./layout/sideBar.ejs') %>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper bg-gray-dark">
        <!-- partial:partials/_navbar.html -->
        <!-- partial -->
        <div class="main-panel">
            <div class="content-wrapper">
                <div class="row">
                    <div class="col-12 grid-margin">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title mb-4">
                                    <i class="fas fa-shopping-cart me-2"></i> Order Management
                                </h4>
                                
                                <!-- Stats Cards -->
                                <div class="row mb-4">
                                    <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <div class="d-flex align-items-center align-self-start">
                                                            <h3 class="mb-0"><%= stats.totalOrders || 0 %></h3>
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-success">
                                                            <i class="fas fa-shopping-cart"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                                <h6 class="text-muted mt-1 font-weight-normal">Total Orders</h6>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <div class="d-flex align-items-center align-self-start">
                                                            <h3 class="mb-0"><%= stats.todayOrders || 0 %></h3>
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-info">
                                                            <i class="fas fa-calendar-day"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                                <h6 class="text-muted mt-1 font-weight-normal">Today's Orders</h6>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <div class="d-flex align-items-center align-self-start">
                                                            <h3 class="mb-0"><%= stats.pendingOrders || 0 %></h3>
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-warning">
                                                            <i class="fas fa-clock"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                                <h6 class="text-muted mt-1 font-weight-normal">Pending Orders</h6>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-9">
                                                        <div class="d-flex align-items-center align-self-start">
                                                            <h3 class="mb-0">₹<%= stats.totalRevenue || 0 %></h3>
                                                        </div>
                                                    </div>
                                                    <div class="col-3">
                                                        <div class="icon icon-box-danger">
                                                            <i class="fas fa-rupee-sign"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                                <h6 class="text-muted mt-1 font-weight-normal">Total Revenue</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Filter and Search Bar -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <form method="GET" action="/admin/adminOrder" class="row g-3">
                                                    <div class="col-md-5">
                                                        <div class="input-group">
                                                            <span class="input-group-text">
                                                                <i class="fas fa-search"></i>
                                                            </span>
                                                            <input type="text" 
                                                                   class="form-control" 
                                                                   name="search" 
                                                                   placeholder="Search by Order ID, Customer Name, Email..." 
                                                                   value="<%= searchQuery %>">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <select class="form-select" name="status">
                                                            <option value="all" <%= statusFilter === 'all' ? 'selected' : '' %>>All Status</option>
                                                            <option value="active" <%= statusFilter === 'active' ? 'selected' : '' %>>Active</option>
                                                            <option value="processing" <%= statusFilter === 'processing' ? 'selected' : '' %>>Processing</option>
                                                            <option value="shipped" <%= statusFilter === 'shipped' ? 'selected' : '' %>>Shipped</option>
                                                            <option value="delivered" <%= statusFilter === 'delivered' ? 'selected' : '' %>>Delivered</option>
                                                            <option value="cancelled" <%= statusFilter === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                                                            <option value="returned" <%= statusFilter === 'returned' ? 'selected' : '' %>>Returned</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <div class="d-flex gap-2">
                                                            <button type="submit" class="btn btn-primary">
                                                                <i class="fas fa-filter me-2"></i> Filter
                                                            </button>
                                                            <a href="/admin/adminOrder" class="btn btn-secondary">
                                                                <i class="fas fa-redo me-2"></i> Reset
                                                            </a>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Orders Table -->
                                <div class="row">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <h4 class="card-title mb-4">Orders List</h4>
                                                <div class="table-responsive">
                                                    <table class="table table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>Order ID</th>
                                                                <th>Customer</th>
                                                                <th>Date</th>
                                                                <th>Items</th>
                                                                <th>Amount</th>
                                                                <th>Status</th>
                                                                <th>Payment</th>
                                                                <th>Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <% if(orderData && orderData.length > 0) { %>
                                                                <% orderData.forEach(order => { %>
                                                                <tr data-order-id="<%= order._id %>" data-current-status="<%= order.orderStatus %>">
                                                                    <td>
                                                                        <span class="badge bg-info text-dark">#<%= order.orderId %></span>
                                                                    </td>
                                                                    <td>
                                                                        <div class="d-flex flex-column">
                                                                            <strong><%= order.userName %></strong>
                                                                            <small class="text-muted"><%= order.address?.Email %></small>
                                                                        </div>
                                                                    </td>
                                                                    <td>
                                                                        <div><%= order.formattedDate %></div>
                                                                        <small class="text-muted"><%= order.formattedTime %></small>
                                                                    </td>
                                                                    <td>
                                                                        <span class="badge bg-light text-dark"><%= order.totalItems %> items</span>
                                                                    </td>
                                                                    <td>
                                                                        <strong class="text-success">₹<%= order.totalAmount %></strong>
                                                                        <% if(order.couponApplied?.discountAmount) { %>
                                                                            <br><small class="text-danger">-₹<%= order.couponApplied.discountAmount %></small>
                                                                        <% } %>
                                                                    </td>
                                                                    <td>
                                                                        <div class="dropdown">
                                                                            <button class="btn btn-sm <%= order.statusClass %> dropdown-toggle" 
                                                                                    type="button" 
                                                                                    id="statusDropdown_<%= order._id %>"
                                                                                    data-toggle="dropdown" 
                                                                                    aria-haspopup="true" 
                                                                                    aria-expanded="false"
                                                                                    <%= order.allowedNextStatuses.length === 0 ? 'disabled' : '' %>>
                                                                                <%= order.orderStatus %>
                                                                            </button>
                                                                            <div class="dropdown-menu" aria-labelledby="statusDropdown_<%= order._id %>">
                                                                                <% order.allowedNextStatuses.forEach(status => { %>
                                                                                    <a class="dropdown-item update-status-btn" 
                                                                                       href="#"
                                                                                       data-order-id="<%= order._id %>"
                                                                                       data-new-status="<%= status %>">
                                                                                        <%= status.charAt(0).toUpperCase() + status.slice(1) %>
                                                                                    </a>
                                                                                <% }); %>
                                                                                <% if(order.allowedNextStatuses.length === 0) { %>
                                                                                    <span class="dropdown-item text-muted">No further actions</span>
                                                                                <% } %>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td>
                                                                        <span class="badge <%= order.paymentStatus === 'Approved' ? 'badge-success' : 
                                                                                              order.paymentStatus === 'Pending' ? 'badge-warning' : 
                                                                                              order.paymentStatus === 'Refunded' ? 'badge-info' : 'badge-secondary' %>">
                                                                            <%= order.paymentStatus %>
                                                                        </span>
                                                                        <br>
                                                                        <small class="text-muted"><%= order.paymentMethod %></small>
                                                                    </td>
                                                                    <td>
                                                                        <div class="btn-group" role="group">
                                                                            <button type="button" 
                                                                                    class="btn btn-outline-info btn-sm view-order-btn"
                                                                                    data-order-id="<%= order._id %>"
                                                                                    title="View Details">
                                                                                <i class="fas fa-eye"></i>
                                                                            </button>
                                                                            <a href="/admin/orderedProductView?orderId=<%= order._id %>" 
                                                                               class="btn btn-outline-primary btn-sm"
                                                                               title="View Products">
                                                                                <i class="fas fa-box-open"></i>
                                                                            </a>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <% }); %>
                                                            <% } else { %>
                                                                <tr>
                                                                    <td colspan="8" class="text-center py-5">
                                                                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                                                        <h5 class="text-muted">No orders found</h5>
                                                                        <% if(searchQuery || statusFilter !== 'all') { %>
                                                                            <p class="text-muted">Try changing your search or filter criteria</p>
                                                                        <% } else { %>
                                                                            <p class="text-muted">No orders have been placed yet</p>
                                                                        <% } %>
                                                                    </td>
                                                                </tr>
                                                            <% } %>
                                                        </tbody>
                                                    </table>
                                                </div>

                                                <!-- Pagination -->
                                                <% if(totalPages > 1) { %>
                                                    <nav aria-label="Order pagination" class="mt-4">
                                                        <ul class="pagination justify-content-center">
                                                            <% if(currentPage > 1) { %>
                                                                <li class="page-item">
                                                                    <a class="page-link" href="/admin/adminOrder?page=<%= currentPage - 1 %><%= searchQuery ? '&search=' + searchQuery : '' %><%= statusFilter !== 'all' ? '&status=' + statusFilter : '' %>">
                                                                        <i class="fas fa-chevron-left"></i>
                                                                    </a>
                                                                </li>
                                                            <% } %>
                                                            
                                                            <% for(let i = 1; i <= totalPages; i++) { %>
                                                                <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                                                    <a class="page-link" href="/admin/adminOrder?page=<%= i %><%= searchQuery ? '&search=' + searchQuery : '' %><%= statusFilter !== 'all' ? '&status=' + statusFilter : '' %>">
                                                                        <%= i %>
                                                                    </a>
                                                                </li>
                                                            <% } %>
                                                            
                                                            <% if(currentPage < totalPages) { %>
                                                                <li class="page-item">
                                                                    <a class="page-link" href="/admin/adminOrder?page=<%= currentPage + 1 %><%= searchQuery ? '&search=' + searchQuery : '' %><%= statusFilter !== 'all' ? '&status=' + statusFilter : '' %>">
                                                                        <i class="fas fa-chevron-right"></i>
                                                                    </a>
                                                                </li>
                                                            <% } %>
                                                        </ul>
                                                    </nav>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- content-wrapper ends -->
            <!-- partial:partials/_footer.html -->
            <%- include('./layout/footer.ejs') %>
            <!-- partial -->
        </div>
        <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
</div>

<!-- Order Details Modal -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Order Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="orderDetailsContent">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div class="d-none" id="loadingSpinner">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<!-- Bootstrap 4 Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
// Helper function to get next allowed statuses (matching backend logic)
function getNextAllowedStatuses(currentStatus) {
    const statusFlow = {
        'active': ['processing', 'cancelled'],
        'processing': ['shipped', 'cancelled'],
        'shipped': ['delivered', 'cancelled'],
        'delivered': ['returned'],
        'cancelled': [], // Cannot change from cancelled
        'returned': []   // Cannot change from returned
    };
    
    return statusFlow[currentStatus] || [];
}

// Helper function to get status class
function getStatusClass(status) {
    const classes = {
        'active': 'btn-success',
        'processing': 'btn-info',
        'shipped': 'btn-primary',
        'delivered': 'btn-success',
        'cancelled': 'btn-danger',
        'returned': 'btn-warning'
    };
    return classes[status] || 'btn-secondary';
}

// Helper function to get badge class for payment status
function getPaymentBadgeClass(paymentStatus) {
    const classes = {
        'Approved': 'badge-success',
        'Pending': 'badge-warning',
        'Refunded': 'badge-info',
        'Cancelled': 'badge-secondary'
    };
    return classes[paymentStatus] || 'badge-secondary';
}

$(document).ready(function() {
    // Initialize Bootstrap 4 dropdowns
    $('.dropdown-toggle').dropdown();
    
    // Update status using dropdown
    $(document).on('click', '.update-status-btn', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const orderId = $(this).data('order-id');
        const newStatus = $(this).data('new-status');
        const row = $(this).closest('tr');
        const currentStatus = row.data('current-status');
        
        console.log('Current Status:', currentStatus);
        console.log('New Status:', newStatus);
        
        // Get allowed next statuses for current status
        const allowedNextStatuses = getNextAllowedStatuses(currentStatus);
        console.log('Allowed next statuses:', allowedNextStatuses);
        
        // Validate if the transition is allowed
        if (!allowedNextStatuses.includes(newStatus)) {
            Swal.fire({
                icon: 'error',
                title: 'Invalid Status Change',
                text: `Cannot change status from ${currentStatus} to ${newStatus}. Allowed next statuses: ${allowedNextStatuses.join(', ') || 'None'}`
            });
            return;
        }
        
        // For cancelled/returned statuses, ask for reason
        if (newStatus === 'cancelled' || newStatus === 'returned') {
            Swal.fire({
                title: `Reason for ${newStatus}`,
                input: 'text',
                inputLabel: `Please provide reason for marking as ${newStatus}`,
                inputPlaceholder: 'Enter reason...',
                showCancelButton: true,
                confirmButtonText: 'Update Status',
                cancelButtonText: 'Cancel',
                inputValidator: (value) => {
                    if (!value) {
                        return 'Please provide a reason';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    updateOrderStatus(orderId, newStatus, result.value, row, currentStatus);
                }
            });
        } else {
            Swal.fire({
                title: 'Update Status?',
                text: `Change order status from ${currentStatus} to ${newStatus}?`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, update it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    updateOrderStatus(orderId, newStatus, null, row, currentStatus);
                }
            });
        }
    });

    // Update order status function
    function updateOrderStatus(orderId, newStatus, reason, row, currentStatus) {
        // Show loading on the row
        row.addClass('table-warning');
        
        $.ajax({
            url: '/admin/update-order-status',
            method: 'POST',
            data: {
                orderId: orderId,
                newStatus: newStatus,
                reason: reason || ''
            },
            success: function(response) {
                row.removeClass('table-warning');
                console.log('Response:', response);
                
                if (response.success) {
                    const order = response.order;
                    
                    // Update the current status in data attribute
                    row.data('current-status', order.status);
                    
                    // Get the dropdown elements
                    const dropdownDiv = row.find('.dropdown');
                    const statusBtn = dropdownDiv.find('button');
                    const dropdownMenu = dropdownDiv.find('.dropdown-menu');
                    
                    // Update the status button
                    statusBtn.removeClass().addClass(`btn btn-sm ${order.statusClass} dropdown-toggle`);
                    statusBtn.attr('class', `btn btn-sm ${order.statusClass} dropdown-toggle`);
                    statusBtn.text(order.status.charAt(0).toUpperCase() + order.status.slice(1));
                    
                    // Update allowed actions
                    if (order.allowedNextStatuses.length === 0) {
                        statusBtn.prop('disabled', true);
                        statusBtn.removeAttr('data-toggle');
                        statusBtn.removeClass('dropdown-toggle');
                    } else {
                        statusBtn.prop('disabled', false);
                        statusBtn.attr('data-toggle', 'dropdown');
                        statusBtn.addClass('dropdown-toggle');
                    }
                    
                    // Update dropdown menu
                    dropdownMenu.empty();
                    
                    if (order.allowedNextStatuses.length === 0) {
                        dropdownMenu.append(`
                            <span class="dropdown-item text-muted">
                                No further actions
                            </span>
                        `);
                    } else {
                        order.allowedNextStatuses.forEach(status => {
                            dropdownMenu.append(`
                                <a class="dropdown-item update-status-btn" 
                                   href="#"
                                   data-order-id="${orderId}"
                                   data-new-status="${status}">
                                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                                </a>
                            `);
                        });
                    }
                    
                    // Update payment status badge
                    const paymentBadge = row.find('td:nth-child(7) .badge');
                    if (newStatus === 'delivered') {
                        paymentBadge.removeClass().addClass('badge badge-success').text('Approved');
                    } else if (newStatus === 'cancelled' || newStatus === 'returned') {
                        paymentBadge.removeClass().addClass('badge badge-info').text('Refunded');
                    }
                    
                    // Re-initialize the dropdown
                    statusBtn.dropdown();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Updated!',
                        text: response.message,
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: response.message
                    });
                }
            },
            error: function(xhr, status, error) {
                row.removeClass('table-warning');
                console.error('AJAX Error:', error);
                console.error('Response:', xhr.responseText);
                
                let errorMessage = 'Failed to update order status';
                try {
                    const response = JSON.parse(xhr.responseText);
                    errorMessage = response.message || errorMessage;
                } catch (e) {
                    errorMessage = xhr.responseText || errorMessage;
                }
                
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage
                });
            }
        });
    }

    // View order details
    $(document).on('click', '.view-order-btn', function() {
        const orderId = $(this).data('order-id');
        
        // Show loading in modal
        $('#orderDetailsContent').html(`
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading order details...</p>
            </div>
        `);
        
        $('#orderDetailsModal').modal('show');
        
        $.ajax({
            url: `/admin/order-details/${orderId}`,
            method: 'GET',
            success: function(response) {
                if (response.success) {
                    const order = response.order;
                    
                    let productsHtml = '';
                    order.productDetails.forEach((item, index) => {
                        const product = item.productId;
                        productsHtml += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${product?.name || 'Product Not Found'}</td>
                                <td>${item.purchasedCount}</td>
                                <td>₹${product?.price || 0}</td>
                                <td>₹${(product?.price || 0) * item.purchasedCount}</td>
                            </tr>
                        `;
                    });
                    
                    $('#orderDetailsContent').html(`
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Order Information</h6>
                                <p><strong>Order ID:</strong> ${order._id.toString().slice(-6).toUpperCase()}</p>
                                <p><strong>Date:</strong> ${order.formattedDate}</p>
                                <p><strong>Status:</strong> 
                                    <span class="badge ${getStatusClass(order.orderStatus).replace('btn-', 'badge-')}">
                                        ${order.orderStatus}
                                    </span>
                                </p>
                                <p><strong>Payment:</strong> 
                                    <span class="badge ${getPaymentBadgeClass(order.paymentStatus)}">
                                        ${order.paymentStatus}
                                    </span> (${order.paymentMethod})
                                </p>
                            </div>
                            <div class="col-md-6">
                                <h6>Customer Information</h6>
                                <p><strong>Name:</strong> ${order.userName}</p>
                                <p><strong>Email:</strong> ${order.address?.Email}</p>
                                <p><strong>Phone:</strong> ${order.address?.PhoneNumber}</p>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <h6>Shipping Address</h6>
                        <p>${order.address?.Address}, ${order.address?.Place}, ${order.address?.state} - ${order.address?.Pincode}</p>
                        
                        <hr>
                        
                        <h6>Order Items</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Product</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productsHtml}
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
                                        <td><strong>₹${order.subtotal}</strong></td>
                                    </tr>
                                    ${order.couponApplied?.discountAmount ? `
                                    <tr>
                                        <td colspan="4" class="text-end"><strong>Discount:</strong></td>
                                        <td><strong class="text-danger">-₹${order.couponApplied.discountAmount}</strong></td>
                                    </tr>
                                    ` : ''}
                                    <tr>
                                        <td colspan="4" class="text-end"><strong>Shipping:</strong></td>
                                        <td><strong>₹${order.shippingPrice || 0}</strong></td>
                                    </tr>
                                    <tr>
                                        <td colspan="4" class="text-end"><strong>Total:</strong></td>
                                        <td><strong class="text-success">₹${order.Total}</strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    `);
                } else {
                    $('#orderDetailsContent').html(`
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            ${response.message}
                        </div>
                    `);
                }
            },
            error: function() {
                $('#orderDetailsContent').html(`
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Failed to load order details
                    </div>
                `);
            }
        });
    });

    // Auto-refresh stats every 60 seconds
    setInterval(function() {
        $.ajax({
            url: '/admin/order-stats',
            method: 'GET',
            success: function(response) {
                if (response.success) {
                    // Update stats cards if needed
                    console.log('Stats refreshed:', response.stats);
                }
            }
        });
    }, 60000);
});
</script>